#!/bin/bash
# Vaminfo - A simple system fetch tool made just for VamoraOS ğŸ’™
# Author: TheVamoraProject
# License: MIT

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Paths and version check helpers
INSTALL_PATH="/usr/bin/vaminfo"
LOCAL_INFO="/etc/VamoraSys/VaminfoInfo.vmf"
REMOTE_INFO="https://raw.githubusercontent.com/TheVamoraProject/Vaminfo/main/VaminfoInfo.vmf"

get_version() {
    if [ -f "$1" ]; then
        grep -oP '(?<=VAMINFO_VERSION=").*(?=")' "$1"
    else
        echo "0"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# System info variables (use your existing $DISTRO, $CPU, etc.)
USER=$(whoami)
HOSTNAME=$(hostname)
OS=$DISTRO
KERNEL=$(uname -r)
CPU=$CPU
MEM=$MEM
GPU=$GPU
UPTIME=$(uptime -p)
SHELL=$SHELL

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Banner
print_info() {
    echo -e "ğŸ’™ Vaminfo - System Info for VamoraOS ğŸ’™"
    echo -e "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "ï€‡ User:      $USER@$HOSTNAME"
    echo "ï…¼ Distro:    $OS"
    echo "îœ’ Kernel:    $KERNEL"
    echo "î‰¦ CPU:       $CPU"
    echo "ó°› Memory:    $MEM"
    echo "ó°¹ GPU:       $GPU"
    echo "ó°”  Uptime:    $UPTIME"
    echo "î• Shell:     $SHELL"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Update function
update_vaminfo() {
    echo "ğŸ” Checking for updates from GitHub..."

    # Get local + remote version numbers
    LOCAL_VER=$(get_version "$LOCAL_INFO")
    REMOTE_VER=$(curl -s "$REMOTE_INFO" | grep -oP '(?<=VAMINFO_VERSION=").*(?=")')

    if [ -z "$REMOTE_VER" ]; then
        echo "âŒ Failed to check latest version."
        exit 1
    fi

    if [ "$REMOTE_VER" != "$LOCAL_VER" ]; then
        echo "â¬‡ï¸  New version available: $REMOTE_VER"
        echo "Updating vaminfo..."
        TMPDIR=$(mktemp -d)
        git clone https://github.com/TheVamoraProject/Vaminfo.git "$TMPDIR"
        if [ -f "$TMPDIR/vaminfo" ]; then
            sudo mv "$TMPDIR/vaminfo" "$INSTALL_PATH"
            sudo chmod +x "$INSTALL_PATH"
            echo "âœ… Updated to version $REMOTE_VER!"
            echo "VAMINFO_VERSION=\"$REMOTE_VER\"" | sudo tee "$LOCAL_INFO" > /dev/null
        else
            echo "âŒ Failed: update script not found in repo."
        fi
        rm -rf "$TMPDIR"
    else
        echo "âœ… Already up to date (version $LOCAL_VER)."
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Usage
show_help() {
    echo "Vaminfo - A simple system fetch tool made just for VamoraOS ğŸ’™"
    echo
    echo "Usage: vaminfo [options]"
    echo
    echo "Options:"
    echo "  --help, -h      Show this help message"
    echo "  --version, -v   Show version info"
    echo "  --update, -u    Update vaminfo to latest version"
    exit 0
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Argument handling
case "$1" in
    -h|--help)
        show_help
        ;;
    -v|--version)
        if [ -f "$LOCAL_INFO" ]; then
            VER=$(get_version "$LOCAL_INFO")
            echo "vaminfo version $VER"
        else
            echo "vaminfo version unknown (no local version file)"
        fi
        ;;
    -u|--update)
        update_vaminfo
        ;;
    "" )
        print_info
        ;;
    * )
        echo "âŒ Unknown option: $1"
        show_help
        ;;
esac
